let modalWindows=[],modalState={},deadline="2020-09-15";function createModal(e){const t=document.querySelector(e),o=t.querySelector(".popup-message"),l=getScroll();return{modalWindow:t,openModal:function(){t.style.display="block",document.body.style.overflow="hidden",document.body.style.marginRight=l+"px"},closeModal:function(){t.style.display="none",document.body.style.overflow="",document.body.style.marginRight="0px"},showMessage:function(e){o.textContent=e},hideMessage:function(){o.textContent=""}}}function modals(){modalData.forEach(e=>{!function({triggerSelector:e,closeSelector:t,modalSelector:o,closeByOverlay:l=!0}){const n=document.querySelectorAll(e);let c=null;const a=createModal(o);modalWindows.push(a),t&&(c=document.querySelector(t)),n.forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),modalWindows.forEach(e=>{e.closeModal()}),a.openModal()})}),null!==c&&c.addEventListener("click",e=>{e.target.closest(t)&&a.closeModal()}),a.modalWindow.addEventListener("click",e=>{l&&e.target===a.modalWindow&&a.closeModal()})}(e)})}function formsHandling(e){const t=document.querySelectorAll(".contact-form"),o=document.querySelectorAll(".contact-form input"),l="Загрузка...",n="Спасибо! Мы Вам скоро перезвоним.",c="Ошибка",a="Не корректно введен номер телефона";t.forEach(t=>{t.addEventListener("submit",r=>{r.preventDefault();const u=t.querySelector("button"),s=t.querySelector(".popup-message");if(19==t.querySelector('input[name="user_phone"]').value.length){const a=new FormData(t);if(0!==Object.keys(modalState).length)for(let e in modalState)a.append(e,modalState[e]);(async function(e,t,o,n){return o.setAttribute("type","button"),n.textContent=l,(await fetch(e,{method:"POST",body:t})).text()})("server.php",a,u,s).then(e=>{console.log(e),s.textContent=n}).catch(e=>{console.log(e),s.textContent=c}).finally(()=>{o.forEach(e=>{e.value=""}),modalState={},function(){const e=document.querySelector("#width"),t=document.querySelector("#height"),o=document.querySelectorAll("input.checkbox");e.value="",t.value="",o.forEach(e=>{e.checked=!1})}(),setTimeout(()=>{u.setAttribute("type","submit"),s.textContent="",e.forEach(e=>{e.closeModal()})},3e3)})}else s.textContent=a})})}function changeModalState(){const e=document.querySelectorAll(".balcon_icons_img"),t=document.querySelectorAll("#width"),o=document.querySelectorAll("#height"),l=document.querySelectorAll("#view_type"),n=document.querySelectorAll("input.checkbox"),c=document.querySelectorAll(".popup_calc_button"),a=document.querySelectorAll(".popup_calc_profile_button");function r(e,t,o){e.forEach((l,n)=>{l.addEventListener(t,t=>{switch(l.nodeName){case"SPAN":modalState[o]=n+1;break;case"INPUT":"text"===l.getAttribute("type")?modalState[o]=l.value:"checkbox"===l.getAttribute("type")&&(0==n?(modalState[o]="cold",e[0].cheked=!0,e[1].cheked=!1):1==n&&(modalState[o]="warm",e[1].cheked=!0,e[0].cheked=!1));break;case"SELECT":modalState[o]=l.value;break;case"BUTTON":t.target.classList.contains("popup_calc_button")&&s({currentModalSelector:".popup_calc",nextModalSelector:".popup_calc_profile",closeSelector:".popup_calc_profile_close",properties:["form","width","height"]}),t.target.classList.contains("popup_calc_profile_button")&&s({currentModalSelector:".popup_calc_profile",nextModalSelector:".popup_calc_end",closeSelector:".popup_calc_end_close",properties:["type","profile"]})}console.log(modalState)})})}function u(e){document.querySelectorAll(e).forEach(e=>{e.addEventListener("input",()=>{e.value=e.value.replace(/\D/,"")})})}function s({currentModalSelector:e,nextModalSelector:t,closeSelector:o,properties:l}){modalWindows.forEach((n,c)=>{if(n.modalWindow==event.target.closest(e))if(l.every(e=>modalState.hasOwnProperty(e))){modalWindows[c].closeModal();const e=createModal(t);modalWindows.push(e),e.openModal(),e.modalWindow.querySelector(o).addEventListener("click",()=>{e.closeModal()})}else modalWindows[c].showMessage("Выберите все параметры"),setTimeout(()=>{modalWindows[c].hideMessage()},3e3)})}u("#width"),u("#height"),r(e,"click","form"),r(t,"input","width"),r(o,"input","height"),r(l,"change","type"),r(n,"change","profile"),r(c,"click"),r(a,"click")}const modalData=[{triggerSelector:".popup_engineer_btn",closeSelector:".popup_engineer button.popup_close",modalSelector:".popup_engineer"},{triggerSelector:".header-callback__link",closeSelector:".popup .popup_close",modalSelector:".popup"},{triggerSelector:".questions__link",closeSelector:".popup .popup_close",modalSelector:".popup"},{triggerSelector:".glazing_content .popup_calc_btn",closeSelector:".popup_calc .popup_calc_close",modalSelector:".popup_calc"}];function getScroll(){let e=document.createElement("div");e.style.cssText="\n        width: 50px;\n        height: 50px;\n        overflow: scroll;\n        visibility: hidden;\n    ",document.body.append(e);let t=e.offsetWidth-e.clientWidth;return e.remove(),t}function inputMask(){const e=document.querySelectorAll('input[name="user_phone"]');let t="";e.forEach(e=>{e.addEventListener("focus",t=>{t.preventDefault(),""===e.value&&(e.value="+")}),e.addEventListener("blur",t=>{t.preventDefault(),"+"===e.value&&(e.value="")}),e.addEventListener("mouseup",t=>{t.preventDefault(),e.setSelectionRange(e.value.length,e.value.length)}),e.addEventListener("input",o=>{/\d/.test(o.data)||null===o.data||(e.value=t),3==e.value.length&&null!==o.data&&(e.value+=" (",e.setSelectionRange(e.value.length,e.value.length)),8==e.value.length&&null!==o.data&&(e.value+=") ",e.setSelectionRange(e.value.length,e.value.length)),(13==e.value.length&&null!==o.data||16==e.value.length&&null!==o.data)&&(e.value+="-",e.setSelectionRange(e.value.length,e.value.length)),""===e.value&&(e.value="+"),t=e.value})})}function tabs(){function e(e,t,o,l,n="flex"){const c=document.querySelector(e),a=document.querySelectorAll(t),r=document.querySelectorAll(o);function u(){a.forEach(e=>{e.classList.remove(l)}),r.forEach(e=>{e.style.display="none"})}function s(e=0){r[e].style.display=n,a[e].classList.add(l)}u(),s(),c.addEventListener("click",e=>{a.forEach((o,l)=>{e.target.closest(t)===o&&(u(),s(l))})})}e(".decoration_slider",".no_click",".decoration_content","after_click"),e(".glazing-slider",".glazing_block",".glazing_content","active"),e(".balcon_icons",".balcon_icons_img",".big_img img","do_image_more","inline")}function timer(e,t){function o(e){return e<10?"0"+e:e}((e,t)=>{const l=document.querySelector(e),n=l.querySelector("#days"),c=l.querySelector("#hours"),a=l.querySelector("#minutes"),r=l.querySelector("#seconds"),u=setInterval(s,1e3);function s(){const e=(e=>{const t=Date.parse(e)-Date.parse(new Date),o=Math.floor(t/1e3%60),l=Math.floor(t/1e3/60%60),n=Math.floor(t/36e5%24);return{total:t,days:Math.floor(t/864e5),hours:n,minutes:l,seconds:o}})(t);n.textContent=o(e.days),c.textContent=o(e.hours),a.textContent=o(e.minutes),r.textContent=o(e.seconds),e.total<=0&&(n.textContent="00",c.textContent="00",a.textContent="00",r.textContent="00",clearInterval(u))}s()})(e,t)}function showBigImages(){const e=document.querySelector(".popup_images"),t=document.querySelector(".popup_images-wrap"),o=document.querySelector(".popup_images-img"),l=document.querySelector("section.works"),n=document.createElement("img"),c=document.querySelectorAll("img.preview"),a=getScroll();n.style.cssText="\n        width: 100%;\n        height: 100%;\n        box-shadow: 0px 0px 30px 30px rgba(0,0,0,0.5)\n    ",o.appendChild(n),l.addEventListener("click",o=>{o.preventDefault();const l=o.target;if(l&&l.classList.contains("preview")){e.style.display="flex",document.body.style.overflow="hidden",document.body.style.marginRight=a+"px";const o=l.getAttribute("src");n.setAttribute("src",o),function(e,o,l){const c=t.querySelectorAll(l);let a=0;o.forEach((t,o)=>{t==e&&(a=o)}),c.forEach(e=>{e.addEventListener("click",e=>{e.target.closest(".previous_arrow")&&a--,e.target.closest(".next_arrow")&&a++,a<0&&(a=o.length-1),a==o.length&&(a=0),n.setAttribute("src",o[a].getAttribute("src"))})})}(l,c,".popup_images-arrow")}}),e.addEventListener("click",o=>{const l=o.target;l&&l==t&&(e.style.display="none",document.body.style.overflow="",document.body.style.marginRight="0px")})}window.addEventListener("DOMContentLoaded",()=>{modals(),formsHandling(modalWindows),tabs(),changeModalState(),showBigImages(),timer(".timer__display",deadline),inputMask()});